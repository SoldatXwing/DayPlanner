@using Microsoft.AspNetCore.Components.Authorization

@inherits LayoutComponentBase

<RadzenComponents />
<div>
    <RadzenLayout>
        <RadzenHeader>
            <AuthorizeView>
                <Authorized>
                    <RadzenStack class="rz-w-100" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">

                        <!-- Left group: Menu and DayPlanner -->
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0">
                            <RadzenSidebarToggle Click="@(() => sidebar1Expanded = !sidebar1Expanded)" />
                            <RadzenLabel Text="DayPlanner" />
                        </RadzenStack>

                        <!-- Right group: Avatar, username, Logout and Toggler -->
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="10px" class="rz-mr-2">
                            @{
                                var avatar = GetUserAvatar();
                                Uri? uri;
                                bool isUrlValid = Uri.TryCreate(avatar, UriKind.Absolute, out uri) &&
                                    uri is not null &&
                                    (uri.Scheme == Uri.UriSchemeHttp || uri.Scheme == Uri.UriSchemeHttps);

                            }
                            @if (!isUrlValid)
                            {
                                <div class="userAvatar">
                                    @avatar
                                </div>
                            }
                            else
                            {
                                <div class="userAvatarImage">
                                    <img src="@avatar" alt="User Avatar" />
                                </div>                               
                            }
                            <RadzenLabel Text="@_user?.DisplayName" />

                            <RadzenButton Click="Logout" Icon="logout" ButtonStyle="ButtonStyle.Light" />
                            <RadzenAppearanceToggle />
                        </RadzenStack>
                    </RadzenStack>
                </Authorized>
                <NotAuthorized>
                    <RadzenStack class="rz-w-100" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">

                        <!-- Left Group: dummy sidebar for spacing -->
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0">
                            <RadzenSidebarToggle Style="visibility: hidden;" /> <!-- Invisible but keeps spacing -->
                            <RadzenLabel Text="DayPlanner" />
                        </RadzenStack>

                        <!-- Right Group: Appearance Toggler -->
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="10px" class="rz-mr-2">
                            <RadzenAppearanceToggle />
                        </RadzenStack>
                    </RadzenStack>
                </NotAuthorized>
            </AuthorizeView>
        </RadzenHeader>

        <AuthorizeView>
            <RadzenSidebar @bind-Expanded="@sidebar1Expanded">
                <RadzenPanelMenu>
                    <RadzenPanelMenuItem Text="Home" Icon="home" Click="@(() => Navigation.NavigateToHome())" />
                    <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Click="@(() => Navigation.NavigateToDashboard())" />
                </RadzenPanelMenu>
                <div class="rz-p-4" />
            </RadzenSidebar>
        </AuthorizeView>

        <RadzenBody>
            <ChildContent>
                <RadzenContentContainer Name="main">
                    @Body
                </RadzenContentContainer>
            </ChildContent>
        </RadzenBody>

        <RadzenFooter class="footer">
            <RadzenRow class="row1" />
                <RadzenRow>
                    <RadzenColumn Size="6">
                        <div class="rz-text-xs">© @DateTime.Now.Year DayPlanner</div>
                    </RadzenColumn>
                    <RadzenColumn Size="6">
                    <div class="rz-text-xs" style="text-align: right;">
                        Made in  <img src="https://upload.wikimedia.org/wikipedia/en/b/ba/Flag_of_Germany.svg" alt="German flag" width="20" style="vertical-align: unset;"> with ❤️
                    </div>
                    </RadzenColumn>
                </RadzenRow>
        </RadzenFooter>
    </RadzenLayout>
</div>